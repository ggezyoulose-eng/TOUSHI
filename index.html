<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>æŠ•è³‡ã‚²ãƒ¼ãƒ </title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: system-ui;
  background: #111;
  color: #fff;
  text-align: center;
}
button, input {
  font-size: 16px;
  padding: 8px 14px;
  margin: 5px;
}
.box {
  margin-top: 12px;
  font-size: 18px;
}
.event {
  color: gold;
  font-weight: bold;
}
canvas {
  background: #000;
  margin-top: 15px;
  border: 1px solid #444;
}
.admin {
  margin-top: 15px;
  border-top: 1px dashed #555;
  padding-top: 10px;
}
.hidden {
  display: none;
}
</style>
</head>
<body>

<h1>ğŸ“ˆ æŠ•è³‡ã‚²ãƒ¼ãƒ </h1>

<div class="box">
  ğŸ’° æ‰€æŒé‡‘ï¼š<span id="money"></span>å††<br>
  ğŸ“¦ ä¿æœ‰æ ªï¼š<span id="stocks"></span>æ ª<br>
  ğŸ’¹ æ ªä¾¡ï¼š<span id="price"></span>å††
</div>

<div class="box">
  <button onclick="buy()">è²·ã†</button>
  <button onclick="sell()">å£²ã‚‹</button>
</div>

<div class="box event" id="eventText"></div>
<div class="box" id="countdown"></div>

<canvas id="chart" width="320" height="150"></canvas>

<div class="admin">
  <div>ğŸ”‘ ç®¡ç†è€…ã‚³ãƒ¼ãƒ‰</div>
  <input id="adminInput" placeholder="ã‚³ãƒ¼ãƒ‰å…¥åŠ›">
  <button onclick="checkAdmin()">OK</button>

  <div id="adminPanel" class="hidden">
    <button onclick="adminBoost()">ğŸ’°+ğŸ“¦ 1000000</button>
    <button onclick="boostLuck()">ğŸ€ æ ªãƒ©ãƒƒã‚¯Ã—10</button>
  </div>
</div>

<script>
let money = 1000;
let stocks = 0;
let price = 100;
let history = [];
let luck = 1;
let adminUnlocked = false;

/* ===== ã‚»ãƒ¼ãƒ–èª­ã¿è¾¼ã¿ ===== */
if (localStorage.saveData) {
  const d = JSON.parse(localStorage.saveData);
  money = d.money ?? money;
  stocks = d.stocks ?? stocks;
  price = d.price ?? price;
  history = d.history ?? history;
  luck = d.luck ?? luck;
  adminUnlocked = d.adminUnlocked ?? adminUnlocked;
}

/* ===== DOM ===== */
const moneyEl = document.getElementById("money");
const stocksEl = document.getElementById("stocks");
const priceEl = document.getElementById("price");
const eventText = document.getElementById("eventText");
const countdownEl = document.getElementById("countdown");
const canvas = document.getElementById("chart");
const ctx = canvas.getContext("2d");
const adminPanel = document.getElementById("adminPanel");

if (adminUnlocked) adminPanel.classList.remove("hidden");

/* ===== ä¿å­˜ ===== */
function save() {
  localStorage.saveData = JSON.stringify({
    money, stocks, price, history, luck, adminUnlocked
  });
}

/* ===== UI ===== */
function updateUI() {
  moneyEl.textContent = Math.floor(money);
  stocksEl.textContent = stocks;
  priceEl.textContent = Math.floor(price);
}

/* ===== ç®¡ç†è€…ã‚¤ãƒ™ãƒ³ãƒˆåˆ¤å®š ===== */
function isAdminEvent() {
  const n = new Date();
  return n.getHours() === 19 && n.getMinutes() < 20;
}

/* ===== ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆæ™‚é–“ãƒ»åˆ†ãƒ»ç§’ï¼‰ ===== */
function updateCountdown() {
  const now = new Date();
  let target = new Date();
  target.setHours(19, 0, 0, 0);

  if (now > target) target.setDate(target.getDate() + 1);

  const diff = target - now;

  const h = Math.floor(diff / 3600000);
  const m = Math.floor((diff % 3600000) / 60000);
  const s = Math.floor((diff % 60000) / 1000);

  if (!isAdminEvent()) {
    countdownEl.textContent =
      `â³ ç®¡ç†è€…ã‚¤ãƒ™ãƒ³ãƒˆã¾ã§ ${h}æ™‚é–“${m}åˆ†${s}ç§’`;
  } else {
    countdownEl.textContent = "";
  }
}

/* ===== æ ªä¾¡æ›´æ–° ===== */
function priceUpdate() {
  let change = (Math.random() * 4 - 2) * luck;

  if (isAdminEvent()) {
    change += Math.random() * 2 * luck;
    eventText.textContent = "ğŸ“¢ ç®¡ç†è€…ã‚¤ãƒ™ãƒ³ãƒˆä¸­ï¼ˆ19:00ã€œ19:20ï¼‰";
  } else {
    eventText.textContent = "";
  }

  price += change;
  if (price < 1) price = 1;

  history.push(price);
  if (history.length > 60) history.shift();

  updateUI();
  drawChart();
  updateCountdown();
  save();
}

/* ===== ã‚°ãƒ©ãƒ•æç”» ===== */
function drawChart() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (history.length < 2) return;

  const max = Math.max(...history);
  const min = Math.min(...history);
  const range = max - min || 1;

  ctx.strokeStyle = "#00ff88";
  ctx.beginPath();

  history.forEach((p, i) => {
    const x = (i / (history.length - 1)) * canvas.width;
    const y = canvas.height - ((p - min) / range) * canvas.height;
    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
  });

  ctx.stroke();
}

/* ===== å£²è²· ===== */
function buy() {
  if (money >= price) {
    money -= price;
    stocks++;
    updateUI();
    save();
  }
}

function sell() {
  if (stocks > 0) {
    money += price;
    stocks--;
    updateUI();
    save();
  }
}

/* ===== ç®¡ç†è€… ===== */
function checkAdmin() {
  if (document.getElementById("adminInput").value === "TTJP") {
    adminUnlocked = true;
    adminPanel.classList.remove("hidden");
    save();
  }
}

function adminBoost() {
  money += 1000000;
  stocks += 1000000;
  updateUI();
  save();
}

function boostLuck() {
  luck *= 10;
  save();
}

/* ===== ãƒ«ãƒ¼ãƒ— ===== */
setInterval(priceUpdate, 1000);
updateUI();
drawChart();
updateCountdown();
</script>

</body>
</html>
